---
title: "Prepae metadata file for asthma data"
author: "TB"
date: "7/28/2017"
output: html_document
---
```{r}
library("tidyverse")
library("stringr")
library("readr")
library("plotly")
library("ggplot2")
library("neutrominer")
library("magrittr")
```

# Load data
Define analysis folder
```{r}
analysis_folder <- "../../analysis/sample/20171001_sample_cp3/"
csv_single_cells <- "Tracked_detectedNeutros.csv"

single_cell_data <- read_csv(file.path(analysis_folder, csv_single_cells)) %>%
  rename(Metadata_timePoint = Metadata_frame) %>%
  mutate(Metadata_timePoint = as.double(Metadata_timePoint))


```


2D plot
```{r}
ggplot(data = single_cell_data) + 
  aes( 
    x = Location_Center_Y, 
    y = Location_Center_X, 
    colour = AreaShape_Compactness,  
    group = TrackObjects_Label) +
  geom_path() +
  #geom_point() + 
  coord_fixed() +
  theme_void() +
  theme(panel.border = element_rect(size = 1, colour = "grey30", fill = NA ) ) 

  
```

3D plot
```{r}

df <- single_cell_data %>% select(Location_Center_Y, Location_Center_X,TrackObjects_Label, Metadata_timePoint ) 


plot_ly(df, 
  x = ~Location_Center_X, 
  y = ~Location_Center_Y, 
  z = ~Metadata_timePoint,  
  split = ~TrackObjects_Label, 
  type = 'scatter3d', 
  mode = 'lines', 
  opacity = 1,
  line = list(width = 2, reverscale = FALSE)
  )

```

```{r}
tracks <- single_cell_data %>%
  group_by(TrackObjects_Label) %>%
  track(., c("TrackObjects_Label"))

tracks %>% assess(., min_path_length = 20)
```
